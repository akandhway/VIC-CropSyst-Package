#ifndef TDF_receiverH
#define TDF_receiverH
#include "corn/data/receiver.h"
#include "corn/container/binary_tree.h"
#include "corn/spreadsheet/workbook.h"
#include "UED/convert/ED_tabular_format.h"
class ED_tabular_file_format;
#define detail_date_default_value 0
namespace CS
{
//____________________________________________________________________________
class TDF_Receiver
: public implements_ CORN::Receiver
{
   const ED_tabular_file_format  &format;
   CORN::Workbook                &workbook;
   nat32                          collated_line_offset;
   CORN::Dynamic_array<CORN::datetime64> detail_timestamps;
      // This is a list of dates encountered  the array index
      // corresponds to the record in the sheet.
      // There should actually be one for EACH sheet.
 protected:
   Workbook::Sheet *current_sheet;
 public:
   TDF_Receiver
      (const ED_tabular_file_format &format_
      ,CORN::Workbook               &workbook_
      ,nat32                         collated_line_offset_);
   virtual nat32 take
      (float32          value
      ,CORN::Units_code units
      ,CORN::datetime64 timestamp
      ,const std::string &ontology
      ,nat32            variable_code);
      // returns the timestamp index
   virtual nat32 take_vector
      (CORN::Dynamic_array<float32> vector_values
      ,CORN::Units_code units
      ,CORN::datetime64 timestamp
      //190423 now using optation ?
      ,const std::string &ontology
      ,nat32            variable_code

      );
   virtual bool know_ID(const std::string &ID);
   virtual bool close(const std::string &ID);
   //190422 abandoed virtual bool close_current();
 protected:
   virtual nat32 set
      (float32          value
      ,nat16            offset
      ,CORN::Units_code units
      ,CORN::datetime64 timestamp
      // now using optation?
      ,const std::string &ontology
      ,nat32            variable_code
      );
      // returns the timestamp index

 protected:
   virtual nat32 commit_detail_line(const Detail_line &detail_line)
      { return 0; } // Not applicable to this specialization
 public:

   inline virtual bool write_detail
      (const CORN::Detail_line &detail_line)                         stream_IO_
         { return false; } // currently using workbook idiom
 private:
   nat16 calc_timestamp_index(CORN::datetime64 timestamp)          calculation_;
};
//_class_TDF_Receiver_abstract______________________________________2019-01-04_/
} // namespace CS
#endif

